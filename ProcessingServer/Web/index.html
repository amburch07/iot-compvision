<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
      <title>YourSecurityFeed</title>
      <link href="styles/styles.css" type="text/css" rel="stylesheet" />


    <script>
      //https://stackoverflow.com/questions/18480550/how-to-load-all-the-images-from-one-of-my-folder-into-my-web-page-using-jquery/18480589#18480589
     //https://stackoverflow.com/questions/492994/compare-two-dates-with-javascript
        window.setInterval(
        function findImages() {
            var folder = "./images/";
            var maxDate = null;
            var newestFile = null;
            
            $.ajax({
                url : folder,
                success: function (data) {
                    $(data).find("a").attr("href", function (i, val) {
                        if(val.match(/\.(jpe?g|png|gif)$/)) {
                            var currentString = val.substring(val.lastIndexOf("\\") + 1).replace(".png", "");
                            
                            var strings = currentString.split('-');
                            var currentDate = new Date(strings[0], strings[1] - 1, strings[2], strings[3], strings[4], strings[5]);
                            
                            if(currentDate > maxDate) {
                                maxDate = currentDate;
                                newestFile = val;
                            }   
                        }
                    });
                    var image = document.getElementById("face");
                    image.src = newestFile;
                }
            });
        }, 1000);  
    </script>


  
 <script>
        // https://stackoverflow.com/questions/951021/what-is-the-javascript-version-of-sleep

            

            function startConnection() {
                var webSocket = new WebSocket("ws://127.0.0.1:5678/");

                var sendStart = document.querySelector(".startButton");
                
                var closeConnection = document.querySelector(".closeButton");

                sendStart.onclick = function(event) {
                    var i = 0;
                    interval = setInterval(function () {
                        i++;
                        webSocket.send("{start}");
                    }, 3000);
                    console.log("Clicked");
                    
                }

                closeConnection.onclick = function(event) {
                    clearInterval(interval);
                }

                webSocket.onmessage = function(event) {
                    console.log("Received message: " + event.data)
                }

                webSocket.onerror = function(event) {
                    console.log("Error: Couldn't connect!")
                    // Display error on page
                }
                
                function sleep(ms) {
                    return new Promise(resolve => setTimeout(resolve, ms));
                }
        };



    </script>

  
</head>

<body onload= "startConnection();">
  <center>
    <h1><b>Your Security Feed</b></h1>
  </center>

  <table class="table1">
    <tr>
      <th>
        <center>
          <b>Facial Recognition</b>
        </center>
      </th>
    </tr>

    <tr>
      <td class="picture">
        <center>
            
          <img id="face" src="images/face.jpg" alt="face" title="face" width="450" height="550"
          frameboader:="4px&quot;" />
        </center>

        <center>
          <b>Detected objects will appear here</b>
        </center>
      </td>
    </tr>

    <tr>
      <td>
        
            <button class="startButton"><img src="images/start.gif:%20alt=" width="450" height="15" />

            <center>
              Start Video Feed
            </center></button> <input type="hidden" name="Start" />
         
      </td>
    </tr>

    <tr>
      <td>
            <button class="closeButton"><img src="images/end.gif:%20alt" width="450" height="15">

            <center>
              End Video Feed
            </center></button> <input type="hidden" name="End" />
        </td>
    </tr>
  </table>

  <table class="table2">
    <tr>
      <th>User Alerts</th>
    </tr>

    <tr>
      <td>Your security system is on</td>
    </tr>

    <tr>
      <td>An object has been detected</td>
    </tr>

    <tr>
      <td>The object is of class Ari_Burch</td>
    </tr>

    <tr>
      <td>The Ari_Burch is approved to enter</td>
    </tr>

    <tr>
      <td class="td2">Door Unlocked</td>
    </tr>
  </table>

  <table class="table3", style="width: 400px">
    <tr>
      <th>Welcome to your security dashboard, this system will scan your face and detect wheather the security door will unlock or lock</th>
    </tr>
  </table>
</body>
</html>
